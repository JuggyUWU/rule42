!function(){function e(e){var t=Array.isArray(e)?{label:e[0],value:e[1]}:"object"==typeof e&&null!=e&&"label"in e&&"value"in e?e:{label:e,value:e};this.label=t.label||t.value,this.value=t.value,this.type=t.type}function t(e,t){return"string"==typeof e?(t||document).querySelector(e):e||null}function i(e,t){return r.call((t||document).querySelectorAll(e))}function n(){i("input.awesomplete").forEach((function(e){new s(e)}))}var s=function(e,i){var n=this;this.isOpened=!1,this.input=t(e),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),i=i||{},function(e,t,i){for(var n in t){var s=t[n],r=e.input.getAttribute("data-"+n.toLowerCase());e[n]="number"==typeof s?parseInt(r):!1===s?null!==r:s instanceof Function?null:r,e[n]||0===e[n]||(e[n]=n in i?i[n]:s)}}(this,{minChars:2,maxItems:10,autoFirst:!1,data:s.DATA,filter:s.FILTER_CONTAINS,sort:!1!==i.sort&&s.SORT_BYLENGTH,item:s.ITEM,replace:s.REPLACE},i),this.index=-1,this.container=t.create("div",{className:"awesomplete",around:e}),this.ul=t.create("ul",{hidden:"hidden",inside:this.container}),this.status=t.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-relevant":"additions",inside:this.container}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keypress:function(e){var t=e.keyCode;if(n.opened){switch(t){case 13:if(1==n.selected){e.preventDefault(),n.select();break}case 66:break;case 27:n.close({reason:"esc"})}console.log(n),console.log(n.selected)}},keydown:function(e){var t=e.keyCode;if(n.opened)switch(t){case 9:if(1==n.selected){e.preventDefault(),n.select();break}case 38:e.preventDefault(),n.previous();break;case 40:e.preventDefault(),n.next()}}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(e){var t=e.target;if(t!==this){for(;t&&!/li/i.test(t.nodeName);)t=t.parentNode;t&&0===e.button&&(e.preventDefault(),n.select(t,e.target))}}}},t.bind(this.input,this._events.input),t.bind(this.input.form,this._events.form),t.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||i.list||[],s.all.push(this)};s.prototype={set list(e){if(Array.isArray(e))this._list=e;else if("string"==typeof e&&e.indexOf(",")>-1)this._list=e.split(/\s*,\s*/);else if((e=t(e))&&e.children){var i=[];r.apply(e.children).forEach((function(e){if(!e.disabled){var t=e.textContent.trim(),n=e.value||t,s=e.label||t;""!==n&&i.push({label:s,value:n})}})),this._list=i}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(e){this.opened&&(this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,t.fire(this.input,"awesomplete-close",e||{}))},open:function(){this.ul.removeAttribute("hidden"),this.isOpened=!0,this.autoFirst&&-1===this.index&&this.goto(0),t.fire(this.input,"awesomplete-open")},destroy:function(){t.unbind(this.input,this._events.input),t.unbind(this.input.form,this._events.form);var e=this.container.parentNode;e.insertBefore(this.input,this.container),e.removeChild(this.container),this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete");var i=s.all.indexOf(this);-1!==i&&s.all.splice(i,1)},next:function(){var e=this.ul.children.length;this.goto(this.index<e-1?this.index+1:e?0:-1)},previous:function(){var e=this.ul.children.length,t=this.index-1;this.goto(this.selected&&-1!==t?t:e-1)},goto:function(e){var i=this.ul.children;this.selected&&i[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&i.length>0&&(i[e].setAttribute("aria-selected","true"),this.status.textContent=i[e].textContent,this.ul.scrollTop=i[e].offsetTop-this.ul.clientHeight+i[e].clientHeight,t.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(e,i){if(e?this.index=t.siblingIndex(e):e=this.ul.children[this.index],e){var n=this.suggestions[this.index];t.fire(this.input,"awesomplete-select",{text:n,origin:i||e})&&(this.replace(n),this.close({reason:"select"}),t.fire(this.input,"awesomplete-selectcomplete",{text:n}))}},evaluate:function(){var t=this,i=this.input.value;i.length>=this.minChars&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map((function(n){return new e(t.data(n,i))})).filter((function(e){return t.filter(e,i)})),!1!==this.sort&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach((function(e){t.ul.appendChild(t.item(e,i))})),0===this.ul.children.length?this.close({reason:"nomatches"}):this.open()):this.close({reason:"nomatches"})}},s.all=[],s.FILTER_CONTAINS=function(e,i){return RegExp(t.regExpEscape(i.trim()),"i").test(e)},s.FILTER_STARTSWITH=function(e,i){return RegExp("^"+t.regExpEscape(i.trim()),"i").test(e)},s.SORT_BYLENGTH=function(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:1},s.ITEM=function(e,i){return t.create("li",{innerHTML:""===i.trim()?e:e.replace(RegExp(t.regExpEscape(i.trim()),"gi"),"<mark>$&</mark>"),"aria-selected":"false"})},s.REPLACE=function(e){this.input.value=e.value},s.DATA=function(e){return e},Object.defineProperty(e.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),e.prototype.toString=e.prototype.valueOf=function(){return""+this.label};var r=Array.prototype.slice;t.create=function(e,i){var n=document.createElement(e);for(var s in i){var r=i[s];if("inside"===s)t(r).appendChild(n);else if("around"===s){var o=t(r);o.parentNode.insertBefore(n,o),n.appendChild(o)}else s in n?n[s]=r:n.setAttribute(s,r)}return n},t.bind=function(e,t){if(e)for(var i in t){var n=t[i];i.split(/\s+/).forEach((function(t){e.addEventListener(t,n)}))}},t.unbind=function(e,t){if(e)for(var i in t){var n=t[i];i.split(/\s+/).forEach((function(t){e.removeEventListener(t,n)}))}},t.fire=function(e,t,i){var n=document.createEvent("HTMLEvents");for(var s in n.initEvent(t,!0,!0),i)n[s]=i[s];return e.dispatchEvent(n)},t.regExpEscape=function(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},t.siblingIndex=function(e){for(var t=0;e=e.previousElementSibling;t++);return t},"undefined"!=typeof Document&&("loading"!==document.readyState?n():document.addEventListener("DOMContentLoaded",n)),s.$=t,s.$$=i,"undefined"!=typeof self&&(self.Awesomplete=s),"object"==typeof module&&module.exports&&(module.exports=s)}();var decodeEntities=function(){var e=document.createElement("div");return function(t){return t&&"string"==typeof t&&(t=(t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"")).replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),e.innerHTML=t,t=e.textContent,e.textContent=""),t}}();function setUp(e){var t;if(null!=e){e.oninput=function(e){var i=e.target.value;if(null!=(i=i.match(/[^ -][^ ]*$/)))if(i=i[0],32==e.keyCode)t.list=[];else{var n=new XMLHttpRequest;n.open("GET","/public/autocomplete.php?q="+i,!0),n.onload=function(){var i=JSON.parse(n.responseText);i.length>0&&"error"===i[0]||(t.list=i,t.evaluate(),t._events.input.keydown(e))},n.send()}},t=new Awesomplete(e,{minChars:1,list:[],filter:function(e,t){var i=t.match(/[^ -][^ ]*$/);return Awesomplete.FILTER_STARTSWITH(e.value,null!=i?i[0]:"")},sort:!1,item:function(e,t){var i=t.match(/[^ -][^ ]*$/);return function(e,t){var i=""===t.trim()?e.label:e.label.replace(RegExp(Awesomplete.$.regExpEscape(t.trim()),"gi"),"<mark>$&</mark>");return console.log(e),Awesomplete.$.create("li",{innerHTML:i,"aria-selected":"false",className:"tag-type-"+e.type})}(e,null!=i?i[0]:"")},replace:function(e){var t=this.input.value.match(/^(.+ )?[\s-]*|/)[0];this.input.value=t+decodeEntities(e.value)+" "}})}}function autocomplete_setup(){var e=localStorage.getItem("doAutocomplete");null==e&&(e="true",localStorage.setItem("doAutocomplete",e)),"true"==e&&document.querySelectorAll('#tags, *[name="my_tags"], #stags, *[name="tags"]').forEach((function(e){setUp(e)})),null!=document.querySelector("#showAutocomplete")&&("true"==e&&(document.querySelector("#showAutocomplete").checked=!0),document.querySelector("#showAutocomplete").onchange=function(e){e.target.checked?localStorage.setItem("doAutocomplete","true"):localStorage.setItem("doAutocomplete","false"),null!=document.querySelector("#tags")&&location.reload()})}window.addEventListener("DOMContentLoaded",(function(){autocomplete_setup()}));